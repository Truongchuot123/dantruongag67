<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Tiến Độ Học Tập</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải Font Awesome cho biểu tượng (ví dụ: dấu check) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Thiết lập font Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100.900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .unit-header {
            background-color: #3b82f6; /* Xanh lam */
            color: white;
            padding: 1rem;
            border-radius: 0.75rem 0.75rem 0 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .unit-content {
            border: 1px solid #e5e7eb;
            border-top: none;
            padding: 1rem 0;
            border-radius: 0 0 0.75rem 0.75rem;
        }
        .lesson-item {
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        .lesson-item:hover {
            background-color: #eff6ff; /* Xanh nhạt khi hover */
        }
        .lesson-item.completed .fa-check-circle {
            color: #10b981; /* Xanh lá cây cho đã hoàn thành */
        }
        .lesson-item .fa-check-circle {
            color: #9ca3af; /* Xám cho chưa hoàn thành */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        
        <!-- HEADER VÀ CHỨC NĂNG LỌC/NÚT TỪ VỰNG -->
        <header class="mb-8 p-6 bg-white shadow-lg rounded-xl">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Quản Lý Tiến Độ Bài Học</h1>
            <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 sm:space-x-4">
                
                <!-- Bộ lọc -->
                <div class="w-full sm:w-auto">
                    <label for="filter" class="block text-sm font-medium text-gray-700 mb-1">Lọc theo trạng thái:</label>
                    <select id="filter" onchange="applyFilter()" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        <option value="all">Tất cả bài học</option>
                        <option value="completed">Đã hoàn thành</option>
                        <option value="uncompleted">Chưa hoàn thành</option>
                    </select>
                </div>

                <!-- Nút Từ Vựng -->
                <a href="/tienganh/vocabulary.html" target="_blank" class="w-full sm:w-auto px-6 py-2 bg-pink-500 text-white font-semibold rounded-lg shadow-md hover:bg-pink-600 transition duration-300 text-center">
                    <i class="fas fa-book-open mr-2"></i>TỪ VỰNG
                </a>
            </div>
        </header>

        <!-- CONTAINER CÁC UNIT HỌC -->
        <div id="units-container" class="space-y-6">
            <!-- Dữ liệu các Unit sẽ được tạo tự động bởi JavaScript -->
        </div>

    </div>

    <script>
        // Dữ liệu mẫu về các Unit và Bài học con
        const unitsData = [

            { 
                id: 'unit1', 
                name: 'UNIT 1: HELLO', 
                lessons: [
                    'Coutries and cities', 
                    'She`s ', 
                    'A perfect recipe', 
                    'Ordering in a restaurant', 
                    'Local specialities'
                ]
            },

            { 
                id: 'unit9', 
                name: 'UNIT 9: TRAVEL', 
                lessons: [
                    'Amazing journeys', 
                    'There are beaches with black sand', 
                    'The weather is perfect', 
                    'Speaking on the phone', 
                    'I love it here'
                ]
            },
            
            { 
                id: 'unit3', 
                name: 'UNIT 3: TECHNOLOGY', 
                lessons: [
                    'The digital world', 
                    'Artificial intelligence', 
                    'Gadgets and devices', 
                    'Giving a presentation', 
                    'The future is now'
                ]
            }
        ];

        // Khởi tạo trạng thái đã học từ localStorage
        let completedLessons = JSON.parse(localStorage.getItem('completedLessons')) || {};

        const unitsContainer = document.getElementById('units-container');

        // Hàm lưu trạng thái vào localStorage
        function saveState() {
            localStorage.setItem('completedLessons', JSON.stringify(completedLessons));
        }

        // Hàm chuyển đổi trạng thái đã học/chưa học
        function toggleCompletion(lessonKey) {
            if (completedLessons[lessonKey]) {
                delete completedLessons[lessonKey];
            } else {
                completedLessons[lessonKey] = true;
            }
            saveState();
            renderUnits(); // Render lại giao diện sau khi thay đổi
            applyFilter(); // Áp dụng lại bộ lọc nếu có
        }

        // Hàm tạo key duy nhất cho mỗi bài học
        function getLessonKey(unitId, lessonName) {
            return `${unitId}-${lessonName.replace(/\s/g, '_').toLowerCase()}`;
        }
        
        // Hàm áp dụng bộ lọc
        function applyFilter() {
            const filterValue = document.getElementById('filter').value;
            const lessonItems = document.querySelectorAll('.lesson-item');

            lessonItems.forEach(item => {
                const isCompleted = item.classList.contains('completed');
                
                // Mặc định ẩn tất cả
                item.classList.add('hidden');

                if (filterValue === 'all') {
                    // Hiện tất cả
                    item.classList.remove('hidden');
                } else if (filterValue === 'completed' && isCompleted) {
                    // Hiện chỉ bài đã hoàn thành
                    item.classList.remove('hidden');
                } else if (filterValue === 'uncompleted' && !isCompleted) {
                    // Hiện chỉ bài chưa hoàn thành
                    item.classList.remove('hidden');
                }
            });

            // Cập nhật hiển thị/ẩn của Unit Content (mở rộng khi có bài thỏa mãn)
            const unitContents = document.querySelectorAll('.unit-content');
            unitContents.forEach(content => {
                const lessonsInUnit = content.querySelectorAll('.lesson-item');
                let hasVisibleLesson = false;
                lessonsInUnit.forEach(lesson => {
                    if (!lesson.classList.contains('hidden')) {
                        hasVisibleLesson = true;
                    }
                });
                
                // Ẩn Unit Content nếu không có bài nào hiển thị, nếu không thì hiển thị
                content.style.display = hasVisibleLesson ? 'block' : 'none';

                // Đảm bảo Unit Header luôn hiển thị
                const unitHeader = content.previousElementSibling;
                if (unitHeader) {
                    unitHeader.style.display = 'flex';
                }
            });
        }

        // Hàm hiển thị giao diện các Unit và Bài học
        function renderUnits() {
            unitsContainer.innerHTML = ''; // Xóa nội dung cũ

            unitsData.forEach(unit => {
                // 1. Tạo div chứa Unit
                const unitDiv = document.createElement('div');
                unitDiv.className = 'rounded-xl shadow-md overflow-hidden bg-white';
                
                // 2. Tạo Header (có thể click để mở/đóng)
                const header = document.createElement('div');
                header.className = 'unit-header flex justify-between items-center text-lg font-semibold';
                header.innerHTML = `
                    <span>${unit.name}</span>
                    <i class="fas fa-chevron-down text-sm"></i>
                `;
                header.onclick = function() {
                    content.classList.toggle('hidden');
                    const icon = this.querySelector('i');
                    icon.classList.toggle('fa-chevron-down');
                    icon.classList.toggle('fa-chevron-up');
                };

                // 3. Tạo Content chứa các bài học (mặc định mở)
                const content = document.createElement('div');
                content.className = 'unit-content'; // hidden nếu muốn mặc định đóng
                
                // 4. Thêm từng Bài học con
                unit.lessons.forEach(lesson => {
                    const lessonKey = getLessonKey(unit.id, lesson);
                    const isCompleted = completedLessons[lessonKey];

                    const lessonItem = document.createElement('div');
                    lessonItem.className = `lesson-item flex items-center justify-between p-3 border-b border-gray-100 last:border-b-0 ${isCompleted ? 'completed' : ''}`;
                    
                    // Nội dung Bài học và sự kiện click
                    lessonItem.innerHTML = `
                        <span class="text-gray-700 font-medium truncate">${lesson}</span>
                        <i class="fas fa-check-circle text-xl ml-4"></i>
                    `;
                    
                    lessonItem.onclick = () => toggleCompletion(lessonKey);
                    
                    content.appendChild(lessonItem);
                });

                // Gắn Header và Content vào Unit Div
                unitDiv.appendChild(header);
                unitDiv.appendChild(content);

                // Gắn Unit Div vào Container chung
                unitsContainer.appendChild(unitDiv);
            });
        }

        // Khởi động ứng dụng
        window.onload = function() {
            renderUnits();
            // Áp dụng bộ lọc lần đầu tiên để đảm bảo trạng thái hiển thị đúng
            applyFilter(); 
        };
    </script>
</body>
</html>